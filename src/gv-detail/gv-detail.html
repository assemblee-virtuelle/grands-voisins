<dom-module id="gv-detail">
  <link rel="import" type="css" href="gv-detail.css">
  <template>
    <div id="detail">
      <ul id="detailTools" class="nav nav-tabs">
        <li role="presentation" class="active">
          <a id="detailBack"
             href="javascript:history.back();"><span class="glyphicon glyphicon-chevron-left"></span>Retour</a>
        </li>
        <li role="presentation" class="active">
          <a id="detailEdit"
             href="#"><span class="glyphicon glyphicon-edit"></span>
            Editer</a>
        </li>
      </ul>
      <div class="row">
        <div class="col col-sm-8">
          <h2>[[title]]</h2>
          <div class="detail-header row">
            <div class="detail-header col col-sm-4">
              <img class="illustration"
                   src="images/logo_les-grands-voisins.png">
            </div>
            <div class="detail-header col col-sm-8">
              <table class="detailInfo">
                <tr>
                  <td>Statut</td>
                  <td>[[status]]</td>
                </tr>
                <tr>
                  <td>Type</td>
                  <td>[[type]]</td>
                </tr>
                <tr>
                  <td>Building</td>
                  <td>[[building]]</td>
                </tr>
                <tr>
                  <td>Site web</td>
                  <td><a href="[[url]]" target="_blank">[[url]]</a></td>
                </tr>
                <tr>
                  <td>Référent</td>
                  <td>[[contact]]</td>
                </tr>
                <tr>
                  <td>e-mail</td>
                  <td>[[email]]</td>
                </tr>
                <tr>
                  <td>Tél.</td>
                  <td>[[phone]]</td>
                </tr>
                <tr>
                  <td></td>
                  <td>[[phone2]]</td>
                </tr>
                <tr>
                  <td>Facebook</td>
                  <td>[[facebook]]</td>
                </tr>
                <tr>
                  <td>Twitter</td>
                  <td>[[twitter]]</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="description">
            [[description]]
          </div>
        </div>
        <div class="col col-sm-4">
          <div class="block">
            <h3>Contribue à</h3>
            <ul>
              <li>
                <a href="#">Projet 1</a>
              </li>
            </ul>
          </div>
          <div class="block">
            <h3>Emploie</h3>
            <ul>
              <li>
                <a href="#">Personne 1</a>
              </li>
              <li>
                <a href="#">Personne 2</a>
              </li>
              <li>
                <a href="#">Personne 3</a>
              </li>
            </ul>
          </div>
          <div class="block">
            <h3>Défend</h3>
            <ul>
              <li>
                <a href="#">Idée 1</a>
              </li>
              <li>
                <a href="#">Idée 2</a>
              </li>
            </ul>
          </div>
          <div class="block">
            <h3>Possède</h3>
            <ul>
              <li>
                <a href="#">Ressource 1</a>
              </li>
              <li>
                <a href="#">Ressource 2</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      is: 'gv-detail',
      properties: {
        id: String,
        title: String,
        description: String,
        route: {
          type: Object,
          observer: '_routeChanged'
        }
      },
      _routeChanged: function (data) {
        // Don't know how to filter out this.
        if (data.prefix === '/detail') {
          window.GVCarto.ready(function () {
            this.refresh(data.path.slice(1));
          }.bind(this));
        }
        else {
          // Hide all maps.
          this.clearMapZone();
        }
      },
      backToResults: function (e) {
        e.preventDefault();
        window.gvc.stateSet('search');
      },
      ready: function () {
        window.gvcDetailComponent = this;
      },
      displayMapZone: function (name, displayMode) {
        document.getElementById('mapZone-' + window.gvc.buildingGetKey(name)).style.display = displayMode || 'block';
      },
      clearMapZone: function () {
        // Hide current map zone.
        if (this.building) {
          this.displayMapZone(this.building, 'none');
        }
      },
      refresh: function (id) {

        window.GVCarto.ready(function () {
          this.clearMapZone();
          let i;
          let data = window.gvc.data[id];
          let filtered = {
            id: id,
            title: data['Nom pour communication'],
            description: data['Activité'] + ' ' + data['Contribution au projet proposée'],
            status: data['SUIVI'],
            type: data['Structure juridique signature convention'],
            email: data['Adresse e-mail'],
            email2: data['Adresse e-mail 2'],
            phone: data['Numéro contact'],
            phone2: data['Numéro contact 2'],
            contact: data['Prénom interlocuteur référent'] + ' ' + data['Nom interlocuteur référent'],
            building: data['Bâtiment'],
            facebook: data['Page Facebook'],
            twitter: data['Compte twitter'],
            url: data['Site Web']
          };
          for (i in filtered) {
            this.set(i, filtered[i]);
          }
          this.displayMapZone(filtered.building);
        }.bind(this));
      }
    });
  </script>
</dom-module>
